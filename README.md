# SaveUs — 식단 영양 위험도 분석 AI 모델

본 문서는 SaveUs 서비스에서 사용되는 **식단 영양 기반 비만 위험도 분석 모델**의 전체 구조, 개발 과정, 성능, 향후 개선 사항을 정리한 기술 문서입니다.

---

# 1. 모델 개요

SaveUs 식단 영양 위험도 모델은 사용자가 오늘 기록한 식단만을 기반으로  
**0~100점의 비만 위험도 점수**를 예측하는 AI 모델입니다.

- **입력 데이터**: 총 칼로리, 지방, 당류, 나트륨, 탄단지 비율  
- **출력 데이터**: 비만 위험도(0~100)  
- **모델 구조**: RandomForestRegressor  
- **학습 데이터**: 국민건강영양조사(KNHANES) 24시간 식이조사 데이터  
- **활용 기능**: SaveUs 식단 기록 분석, 건강 리포트 위험도 표시  

사용자가 기록한 식단만으로 즉시 위험도를 분석하여,  
**식습관 개선을 위한 직관적 피드백 제공**을 목표로 설계되었습니다.

---

# 2. 위험도 산출 공식
**자체 설계한 가중치 기반 점수 산출식**
칼로리·지방·당류·나트륨의 과다 섭취는 건강 위험”이라는 일반적 지침과,
영양 정보 표시 체계(예: 하루 권장량 기준)를 참고하여 편의상 가중치 + 기준값을 정한 것

학습용 레이블(risk_score)은 다음 영양 요소 기반 가중치 계산식으로 생성되었습니다.

- **총 칼로리**: 30%  
- **지방**: 25%  
- **당류**: 20%  
- **나트륨**: 25%  

공식:

```
risk_score =
    (total_calories / 2500 * 30) +
    (total_fat      / 70   * 25) +
    (total_sugar    / 50   * 20) +
    (total_sodium   / 2000 * 25)
```

국민건강영양조사의 권장 기준치를 기반으로 가중치를 설정하였습니다.

---

# 3. 사용 데이터

사용 데이터: **KNHANES — HN23_ALL.sav (24시간 식이조사)**

전처리가 필요한 이유:
- 결측치 비율 높음  
- 극단적으로 높은 영양소 값 존재  
- 칼로리 0인데 영양소만 존재하는 비정상행 많음  
- 탄단지 비율이 0% 또는 100% 초과인 이상치 존재  

**사용한 주요 특성**

- N_EN (총 섭취 칼로리)  
- N_CHO, N_PROT, N_FAT  
- N_SUGAR, N_NA  
- sex, age  
- 탄단지 비율(carb_ratio, protein_ratio, fat_ratio)

---

# 4. 모델 개발 과정에서의 어려움과 해결 방법

## 4.1 공공데이터 품질 문제

### 문제
- 탄단지 비율이 0% 또는 100% 초과  
- 칼로리 0이며 영양소만 기록된 행  
- 잘못 입력된 당류·나트륨 값  
- 개인·영양 데이터 병합 구조 복잡  

### 해결
- 탄단지 비율 0~100% 범위만 허용  
- 칼로리 0 또는 불완전 row 제거  
- IQR 기반 이상치 제거  
- 위험도 레이블 Clip(0~100)으로 안정화  

→ 전처리 후 모델 학습 안정성과 성능 모두 향상됨.

---

## 4.2 위험도 레이블(label) 정의 문제

### 문제
비만 위험도를 보여주는 실제 정답 데이터가 존재하지 않음.

### 해결
- 영양 기준(칼로리·지방·당류·나트륨)의 의학적 권장량 기반 가중치 공식 직접 설계  
- 해당 공식을 y값으로 사용  
- 모델이 이 공식을 근사하도록 학습하여 일반화된 예측 가능  

→ “규칙 기반 점수”를 머신러닝이 고도화된 형태로 학습하는 구조.

---

## 4.3 학습 데이터와 실서비스 입력값의 차이

### 문제
- 학습 데이터는 국민 단위 조사  
- 서비스 입력값은 SaveUs 사용자의 “하루 총합”  
- 두 데이터의 분포가 다름  

### 해결
- 절대량 + 탄단지 비율 조합으로 일반화  
- StandardScaler 적용  
- 비정상적 값 제거로 서비스 입력 분포와 유사하게 정제  

→ 실제 서비스에서도 안정적인 예측 가능.

---

# 5. 모델 성능

- **R² = 0.98**  
- **RMSE ≈ 5.7**  
- 실제값-예측값 산점도에서 y=x 이상적 예측선과 거의 일치  

모델이 위험도 공식을 매우 정확하게 학습했음을 의미합니다.

---

# 6. 시스템 구조

SaveUs 시스템 내 위험도 분석 호출 과정:

1. 사용자 식단 기록 → MySQL 저장  
2. Spring Boot 서버 → FastAPI 모델 서버 호출  
3. FastAPI에서 오늘 섭취 영양 합계 조회  
4. ML 모델에 입력 후 위험도 예측  
5. Spring Boot에 결과 전달  
6. 건강 리포트 페이지에서 시각화  

---

# 7. 향후 개선 방향

## 7.1 식단 기반 예측의 한계 보완
현재는 하루 식단만 반영 → 장기 추세 미반영  
→ 체중 변화, 활동량, 건강 기록 포함하여 예측 고도화 가능.

## 7.2 개인별 맞춤 위험도 가중치
모든 사용자에게 동일 가중치 적용 문제  
→ BMI·성별·연령대별 개인화 가능  
→ 개인 맞춤형 위험도 모델로 확장.

## 7.3 자동 재학습 시스템
SaveUs 사용자 데이터가 쌓이면  
→ 데이터 레이크 기반 주기적 재학습 가능.

---

# 8. 결론

SaveUs 식단 영양 위험도 모델은 다음과 같은 장점이 있습니다.

- 하루 식단만으로 직관적인 위험도 제공  
- 복잡한 병력 없이 간단하고 빠른 분석  
- 공공데이터 기반이라 신뢰도 확보  
- Spring–FastAPI–MySQL 통합으로 실서비스 최적화  
- 사용자의 식습관 개선을 실시간으로 지원  

개발 과정에서 공공데이터 품질 문제, 레이블 정의 문제,  
학습 환경–서비스 환경 간 분포 차이 등 다양한 어려움이 있었으나  
적절한 전처리와 모델 구조 설계를 통해 안정적인 시스템을 구축할 수 있었습니다.

---

